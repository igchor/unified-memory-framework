# CodeQL static analysis
name: CodeQL

# Due to lower score on Scorecard we're running this separately from
# "PR/push" workflow. For some reason permissions weren't properly set
# or recognized (by Scorecard). If Scorecard changes its behavior we can
# go back to use 'workflow_call' trigger.
on: [push, pull_request]

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  qemu:
    name: Qemu
    runs-on: fedora-39
    container:
      image: ghcr.io/igchor/qemu:ubuntu
      volumes:
        - ${{github.workspace}}:/opt/shared
      env:
        CI_BRANCH: ${{ github.head_ref || github.ref_name }}
        CI_REPO: https://github.com/${{github.repository}}
      options: "--privileged --user user"

    steps:
      - name: Checkout
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
      - name: run build in qemu
        run: /opt/shared/scripts/qemu/run-qemu.sh
